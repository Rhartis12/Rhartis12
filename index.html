<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>OSCC Pro Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { background: #0d1117; color: #c9d1d9; font-family: sans-serif; margin: 0; padding: 20px; }
        .container { max-width: 1600px; margin: 0 auto; }
        .ticker-section { margin-bottom: 60px; border-bottom: 1px solid #30363d; padding-bottom: 20px; }
        .ticker-header { display: flex; align-items: center; margin-bottom: 20px; }
        .ticker-title { font-size: 2em; color: #58a6ff; margin: 0 20px 0 0; font-weight: bold; }
        .ticker-price { font-size: 1.5em; color: #fff; }
        
        /* ê·¸ë¦¬ë“œ ë ˆì´ì•„ì›ƒ: ì™¼ìª½ í° ì°¨íŠ¸, ì˜¤ë¥¸ìª½ ì‘ì€ ì°¨íŠ¸ 2ê°œ */
        .dashboard-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            grid-template-rows: 300px 300px;
            gap: 20px;
        }
        .chart-card { background: #161b22; border: 1px solid #30363d; border-radius: 8px; padding: 15px; position: relative; }
        
        /* ì™¼ìª½ ë©”ì¸ ì°¨íŠ¸ëŠ” ì„¸ë¡œë¡œ ê¸¸ê²Œ (2í–‰ ì°¨ì§€) */
        .main-chart { grid-row: span 2; }
        
        canvas { width: 100% !important; height: 100% !important; }
        h3 { margin: 0 0 10px 0; font-size: 1em; color: #8b949e; }
    </style>
</head>
<body>
    <div class="container">
        <h1 style="text-align:center; color:#238636;">ğŸš€ OSCC Strategic Command Center</h1>
        <div id="app"></div>
    </div>

    <script>
        async function renderDashboard() {
            const response = await fetch('./dashboard_data.json');
            const data = await response.json();
            const tickers = [...new Set(data.map(d => d.ticker))];
            const app = document.getElementById('app');

            tickers.forEach(ticker => {
                const tData = data.filter(d => d.ticker === ticker);
                const lastData = tData[tData.length - 1]; // ìµœì‹  ë°ì´í„°
                
                // ìµœì‹  ìƒì„¸ OI êµ¬ì¡° íŒŒì‹±
                let oiData = { strikes: [], call_oi: [], put_oi: [] };
                if (lastData.oi_structure) {
                    try { oiData = JSON.parse(lastData.oi_structure); } catch(e) {}
                }

                // ì„¹ì…˜ ìƒì„±
                const section = document.createElement('div');
                section.className = 'ticker-section';
                section.innerHTML = `
                    <div class="ticker-header">
                        <div class="ticker-title">$${ticker}</div>
                        <div class="ticker-price">Current: $${lastData.price.toFixed(2)}</div>
                    </div>
                    <div class="dashboard-grid">
                        <div class="chart-card main-chart">
                            <h3>Price Action & Net GEX History</h3>
                            <canvas id="c1-${ticker}"></canvas>
                        </div>
                        <div class="chart-card">
                            <h3>âš”ï¸ Battlefield Map (OI Profile)</h3>
                            <canvas id="c2-${ticker}"></canvas>
                        </div>
                        <div class="chart-card">
                            <h3>Sentiment (Skew & PCR)</h3>
                            <canvas id="c3-${ticker}"></canvas>
                        </div>
                    </div>
                `;
                app.appendChild(section);

                // --- Chart 1: Price & GEX (ë©”ì¸) ---
                new Chart(document.getElementById(`c1-${ticker}`), {
                    type: 'line',
                    data: {
                        labels: tData.map(d => d.timestamp),
                        datasets: [
                            {
                                label: 'Price', data: tData.map(d => d.price),
                                borderColor: '#58a6ff', borderWidth: 2, yAxisID: 'y'
                            },
                            {
                                label: 'Net GEX', data: tData.map(d => d.net_gex),
                                type: 'bar', backgroundColor: tData.map(d => d.net_gex > 0 ? 'rgba(35, 134, 54, 0.5)' : 'rgba(218, 54, 51, 0.5)'),
                                yAxisID: 'y1'
                            }
                        ]
                    },
                    options: {
                        responsive: true, maintainAspectRatio: false,
                        interaction: { mode: 'index', intersect: false },
                        scales: {
                            y: { display: true, position: 'left', grid: { color: '#30363d' } },
                            y1: { display: true, position: 'right', grid: { drawOnChartArea: false } }
                        }
                    }
                });

                // --- Chart 2: OI Battlefield (ê°€ë¡œ ë§‰ëŒ€) ---
                new Chart(document.getElementById(`c2-${ticker}`), {
                    type: 'bar',
                    data: {
                        labels: oiData.strikes,
                        datasets: [
                            {
                                label: 'Call OI (Resistance)', data: oiData.call_oi,
                                backgroundColor: 'rgba(35, 134, 54, 0.7)', indexAxis: 'y'
                            },
                            {
                                label: 'Put OI (Support)', data: oiData.put_oi,
                                backgroundColor: 'rgba(218, 54, 51, 0.7)', indexAxis: 'y'
                            }
                        ]
                    },
                    options: {
                        indexAxis: 'y', // ê°€ë¡œ ë§‰ëŒ€
                        responsive: true, maintainAspectRatio: false,
                        scales: {
                            x: { stacked: false, grid: { color: '#30363d' } },
                            y: { stacked: true, grid: { display: false } } // í–‰ì‚¬ê°€
                        },
                        plugins: { legend: { position: 'top' } }
                    }
                });

                // --- Chart 3: Sentiment (Skew) ---
                // ê³¼ê±° ë°ì´í„°ì—ì„œ Skewê°€ 0ì¸(ë°±í•„ëœ) êµ¬ê°„ì€ ì œì™¸í•˜ê³  ê·¸ë¦¬ê¸°
                const validSkewData = tData.filter(d => d.skew !== 0);
                new Chart(document.getElementById(`c3-${ticker}`), {
                    type: 'line',
                    data: {
                        labels: validSkewData.map(d => d.timestamp),
                        datasets: [{
                            label: 'IV Skew (Put/Call)',
                            data: validSkewData.map(d => d.skew),
                            borderColor: '#a371f7',
                            backgroundColor: 'rgba(163, 113, 247, 0.1)',
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true, maintainAspectRatio: false,
                        scales: { y: { grid: { color: '#30363d' } } }
                    }
                });
            });
        }
        renderDashboard();
    </script>
</body>
</html>
